<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GiriÅŸ / Ãœyelik â€“ NexuForge</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body class="page-auth">

  <!-- KARARMA -->
  <div id="overlay"></div>

  <!-- HEADER -->
  <header class="header">
    <div class="logo" onclick="location.href='index.html'">NexuForge</div>
    <div class="header-right">
      <button class="icon-btn" onclick="location.href='notifications.html'">ğŸ””</button>
      <div id="menuToggle" class="edge-toggle">â€¹</div>
    </div>
  </header>

  <!-- SAÄ MENÃœ -->
  <nav id="sidebar" class="sidebar">
    <button id="closeSidebar" class="close-btn">âœ•</button>

    <a href="index.html">ğŸ  Ana Sayfa</a>
    <a href="products.html">ğŸ›’ ÃœrÃ¼nler</a>
    <a href="scrims.html">ğŸ® Scrim / Event</a>
    <a href="dm.html">ğŸ’¬ Sohbet / DM</a>
    <a href="profile.html">ğŸ‘¤ Profilim</a>
    <a href="auth.html">ğŸ” GiriÅŸ / Ãœyelik</a>
    <a href="about.html">â„¹ï¸ HakkÄ±mÄ±zda</a>
    <a href="contact.html">ğŸ“ Ä°letiÅŸim</a>

    <a id="adminLink" href="admin.html" class="admin-link" style="display:none;">âš¡ Admin Panel</a>
  </nav>

  <!-- Ä°Ã‡ERÄ°K -->
  <main class="main auth-main">
    <section class="auth-box">
      <h2>Ãœyelik</h2>

      <div class="auth-section">
        <h3>KayÄ±t Ol</h3>
        <input id="regUsername" placeholder="KullanÄ±cÄ± adÄ±" />
        <input id="regEmail" type="email" placeholder="E-posta" />
        <input id="regPassword" type="password" placeholder="Åifre" />
        <button onclick="registerUser()">KayÄ±t Ol</button>
      </div>

      <div class="auth-section">
        <h3>GiriÅŸ Yap</h3>
        <input id="loginEmail" type="email" placeholder="E-posta" />
        <input id="loginPassword" type="password" placeholder="Åifre" />
        <button onclick="loginUser()">GiriÅŸ Yap</button>
        <p class="small-text" id="loginInfo"></p>
      </div>

      <p class="small-text" id="registerInfo"></p>
    </section>
  </main>

  <!-- JS: Ã¶nce ui, sonra alttaki inline script -->
  <script src="js/ui.js"></script>

  <!-- ğŸ”¥ KAYIT + GÄ°RÄ°Å MANTIÄI BURADA -->
  <script>
    // ========= LOCALSTORAGE HELPER =========
    function safeParse(key, fallback) {
      try {
        const v = localStorage.getItem(key);
        return v ? JSON.parse(v) : fallback;
      } catch (e) {
        return fallback;
      }
    }
    function getUsers() {
      return safeParse("users", []);
    }
    function saveUsers(arr) {
      localStorage.setItem("users", JSON.stringify(arr));
    }
    function getCurrentUser() {
      return safeParse("currentUser", null);
    }
    function saveCurrentUser(user) {
      if (user) localStorage.setItem("currentUser", JSON.stringify(user));
      else localStorage.removeItem("currentUser");
    }

    // KÃ¼fÃ¼r filtresi
    const bannedWords = ["amk","aq","piÃ§","orospu","sikerim","gÃ¶t","yarak","sÃ¼rtÃ¼k","pedofil","sapÄ±k","sapkÄ±n"];

    // ========= KAYIT =========
    function registerUser() {
      const usernameEl = document.getElementById("regUsername");
      const emailEl    = document.getElementById("regEmail");
      const passEl     = document.getElementById("regPassword");
      const infoEl     = document.getElementById("registerInfo");

      const username = usernameEl.value.trim();
      const email    = emailEl.value.trim().toLowerCase();
      const password = passEl.value;

      if (!username || !email || !password) {
        infoEl.textContent = "TÃ¼m alanlarÄ± doldurun.";
        infoEl.style.color = "#f87171";
        return;
      }

      const low = username.toLowerCase();
      if (bannedWords.some(w => low.includes(w))) {
        infoEl.textContent = "Bu kullanÄ±cÄ± adÄ± uygun deÄŸil.";
        infoEl.style.color = "#f87171";
        return;
      }

      let users = getUsers();
      if (users.some(u => u.email === email)) {
        infoEl.textContent = "Bu e-posta zaten kayÄ±tlÄ±.";
        infoEl.style.color = "#f87171";
        return;
      }
      if (users.some(u => u.username.toLowerCase() === username.toLowerCase())) {
        infoEl.textContent = "Bu kullanÄ±cÄ± adÄ± alÄ±nmÄ±ÅŸ.";
        infoEl.style.color = "#f87171";
        return;
      }

      const newUser = {
        uid: "u" + Date.now(),
        username,
        email,
        password,
        role: "user",
        profile: {}
      };

      users.push(newUser);
      saveUsers(users);
      saveCurrentUser(newUser);

      infoEl.textContent = "KayÄ±t baÅŸarÄ±lÄ±! Oturum aÃ§tÄ±nÄ±z.";
      infoEl.style.color = "#4ade80";

      usernameEl.value = "";
      emailEl.value = "";
      passEl.value = "";
    }

    // ========= GÄ°RÄ°Å =========
    function loginUser() {
      const emailEl = document.getElementById("loginEmail");
      const passEl  = document.getElementById("loginPassword");
      const infoEl  = document.getElementById("loginInfo");

      const email    = emailEl.value.trim().toLowerCase();
      const password = passEl.value;

      if (!email || !password) {
        infoEl.textContent = "E-posta ve ÅŸifre zorunlu.";
        infoEl.style.color = "#f87171";
        return;
      }

      const users = getUsers();
      const user = users.find(u => u.email === email && u.password === password);

      if (!user) {
        infoEl.textContent = "E-posta veya ÅŸifre hatalÄ±.";
        infoEl.style.color = "#f87171";
        return;
      }

      saveCurrentUser(user);
      infoEl.textContent = "GiriÅŸ baÅŸarÄ±lÄ±: " + user.username;
      infoEl.style.color = "#4ade80";

      setTimeout(() => {
        window.location.href = "index.html";
      }, 800);
    }

    // ========= SAYFA AÃ‡ILDIÄINDA KÄ°M GÄ°RMÄ°Å GÃ–STER =========
    window.addEventListener("DOMContentLoaded", () => {
      const infoEl = document.getElementById("loginInfo");
      const cur = getCurrentUser();
      if (infoEl && cur) {
        infoEl.textContent = "Åu an giriÅŸ yapan: " + cur.username + " (" + cur.email + ")";
        infoEl.style.color = "#e5e5e5";
      }
    });
  </script>

</body>
</html>
